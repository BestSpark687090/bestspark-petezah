---
import Favicons from './Favicon.astro';

/**
 * Props for the SEO component
 * Configures all Open Graph, Meta, and SEO-related tags
 */
export interface Props {
  // Core SEO
  /** Page title */
  title?: string;
  /** Page meta description */
  description?: string;
  /** Keywords for search engines */
  keywords?: string;
  /** Social media image URL */
  image?: string;
  /** Alternative text for image */
  imageAlt?: string;
  /** Current page path */
  path?: string;
  /** Canonical URL to prevent duplicate content issues */
  canonicalUrl?: string;

  // Content Types
  /** Content type: website | game | article | product | profile | video | discussion */
  type?: 'website' | 'game' | 'article' | 'product' | 'profile' | 'video' | 'discussion';

  // Article Settings
  /** Article type: blog | news | tech | general */
  articleType?: 'blog' | 'news' | 'tech' | 'general';

  // Dates & Author
  /** Publication date (ISO format) */
  publishDate?: string;
  /** Last modification date (ISO format) */
  modifiedDate?: string;
  /** Article author name */
  author?: string;
  /** Article section/category */
  section?: string;
  /** Article tags */
  tags?: string[];
  /** Estimated reading time in minutes */
  readingTime?: number;

  // Product
  /** Product price */
  price?: string;
  /** Currency code */
  currency?: string;

  // Video
  /** Video URL for video metadata */
  videoUrl?: string;
  /** Video width in pixels */
  videoWidth?: number;
  /** Video height in pixels */
  videoHeight?: number;

  // Robots & Indexing
  /** Prevent search engine indexing */
  noindex?: boolean;
  /** Prevent search engine following links */
  nofollow?: boolean;

  // Verification
  /** Search engine verification codes */
  verification?: {
    /** Google Search Console verification code */
    google?: string;
    /** Bing Webmaster Tools verification code */
    bing?: string;
    /** Yandex Webmaster Tools verification code */
    yandex?: string;
    /** Pinterest Site Verification code */
    pinterest?: string;
  };
}

const {
  title,
  description,
  keywords,
  path,
  image,
  imageAlt,
  canonicalUrl,
  type = 'website',
  publishDate,
  modifiedDate,
  author = 'PeteZah Games',
  section,
  tags = [],
  readingTime,
  price,
  currency,
  videoUrl,
  videoWidth,
  videoHeight,
  noindex = false,
  nofollow = false,
  verification = {}
}: Props = Astro.props;

/** Site title */
const siteTitle: string = 'PeteZah Games';
/** Final page title with site name */
const finalTitle: string = title ? `${title} | ${siteTitle}` : siteTitle;
/** Final description or default */
const finalDescription: string = description || 'Play free online games and use web apps on PeteZah Games.';
/** Final keywords or default */
const finalKeywords: string = keywords || 'PeteZah, PeteZah Games, Free Games, Online Games, Browser Games';
/** Final canonical URL */
const canonical: string = canonicalUrl || new URL(path || Astro.url.pathname, Astro.site || Astro.url.origin).href.replace(/\/+$/, '/');

// Robots Logic
const robotsParts = [];
if (noindex) robotsParts.push('noindex');
else robotsParts.push('index');
if (nofollow) robotsParts.push('nofollow');
else robotsParts.push('follow');
if (!noindex) robotsParts.push('max-image-preview:large', 'max-snippet:-1', 'max-video-preview:-1');
const robotsValue = robotsParts.join(', ');

// Image Logic
const socialImage = image
  ? image.startsWith('http')
    ? image
    : new URL(image, Astro.url.origin).href
  : new URL('./ogImage.avif', Astro.url.origin).href;
const socialImageSafe = socialImage.startsWith('http://') ? socialImage.replace('http://', 'https://') : socialImage;
const imageType = socialImage.split('.').pop() === 'avif' ? 'image/avif' : socialImage.split('.').pop() === 'png' ? 'image/png' : 'image/jpeg';

// Type Logic
const ogTypeMap = {
  website: 'website',
  game: 'website',
  article: 'article',
  product: 'product',
  profile: 'profile',
  video: 'video.other',
  discussion: 'website'
};
const ogType = ogTypeMap[type] || 'website';
---

<!-- Basics -->
<title>{finalTitle}</title>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="description" content={finalDescription} />
<meta name="keywords" content={finalKeywords} />
<meta name="author" content={author} />
<meta name="generator" content={Astro.generator} />
<link rel="canonical" href={canonical} />
<meta name="robots" content={robotsValue} />

<!-- Verification -->
{verification.google && <meta name="google-site-verification" content={verification.google} />}
{verification.bing && <meta name="msvalidate.01" content={verification.bing} />}

<!-- Open Graph -->
<meta property="og:site_name" content={siteTitle} />
<meta property="og:title" content={finalTitle} />
<meta property="og:description" content={finalDescription} />
<meta property="og:url" content={canonical} />
<meta property="og:type" content={ogType} />
<meta property="og:image" content={socialImageSafe} />
<meta property="og:image:secure_url" content={socialImageSafe} />
<meta property="og:image:type" content={imageType} />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:image:alt" content={imageAlt || finalTitle} />
<meta property="og:locale" content="en_US" />
{modifiedDate && <meta property="og:updated_time" content={modifiedDate} />}

<!-- Twitter -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@PeteZahGames" />
<meta name="twitter:creator" content="@PeteZahGames" />
<meta name="twitter:title" content={finalTitle} />
<meta name="twitter:description" content={finalDescription} />
<meta name="twitter:image" content={socialImageSafe} />
{readingTime && <meta name="twitter:label1" content="Est. reading time" />}
{readingTime && <meta name="twitter:data1" content={`${readingTime} minutes`} />}

<!-- Article Meta -->
{
  type === 'article' && (
    <>
      <meta property="article:author" content={author} />
      {publishDate && <meta property="article:published_time" content={publishDate} />}
      {modifiedDate && <meta property="article:modified_time" content={modifiedDate} />}
      {section && <meta property="article:section" content={section} />}
      {tags.map((tag) => (
        <meta property="article:tag" content={tag} />
      ))}
    </>
  )
}

<!-- Product Meta -->
{
  type === 'product' && price && currency && (
    <>
      <meta property="product:price:amount" content={price} />
      <meta property="product:price:currency" content={currency} />
    </>
  )
}

<!-- Video Meta -->
{
  type === 'video' && videoUrl && (
    <>
      <meta property="og:video" content={videoUrl} />
      <meta property="og:video:secure_url" content={videoUrl} />
      <meta property="og:video:type" content="video/mp4" />
      {videoWidth && <meta property="og:video:width" content={videoWidth.toString()} />}
      {videoHeight && <meta property="og:video:height" content={videoHeight.toString()} />}
      <meta name="twitter:card" content="player" />
      <meta name="twitter:player" content={videoUrl} />
      {videoWidth && <meta name="twitter:player:width" content={videoWidth.toString()} />}
      {videoHeight && <meta name="twitter:player:height" content={videoHeight.toString()} />}
    </>
  )
}

<Favicons masterIconPath="../assets/images/svg/logo.svg" />
